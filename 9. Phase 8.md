# ðŸ“Œ Phase 8: Add Basic Admin Authentication (Login/Logout)

**Goal**:  
Allow only logged-in admins to create and manage job descriptions.

---

## ðŸ”¹ Step 42: Add Basic Authentication API (Backend)

Right now, we don't have authentication for the admin.

We will:
- Create AdminUser model
- Create login and logout APIs
- Use Django sessions for authentication

---

## ðŸ”¹ Step 43: Create Admin User Model

**(We will use Django's default User model â€” no custom model for now.)**

ðŸ‘‰ No new model needed.

---

## ðŸ”¹ Step 44: Enable Django Authentication

Django comes with built-in authentication!

We will use:
- `django.contrib.auth` for login/logout
- `djangorestframework`'s `obtain_auth_token` for token-based login (later)

---

## ðŸ”¹ Step 45: Install Django Rest Framework Authtoken

We need an extra package to generate tokens.

### **45.1 Run this command:**
```bash
cd ~/ai-recruitment-system/backend
pip install djangorestframework authtoken
```

---

## ðŸ”¹ Step 46: Add `'rest_framework.authtoken'` to `INSTALLED_APPS`

### **46.1 Open file: `backend/backend/settings.py`**

Find `INSTALLED_APPS`, and **add this line** inside it:

```python
INSTALLED_APPS = [
    ...
    'rest_framework',
    'rest_framework.authtoken',
    ...
]
```

---

## ðŸ”¹ Step 47: Run Migrations

Because we added a new app (`authtoken`), migrate the database:

```bash
python manage.py migrate
```

---

## ðŸ”¹ Step 48: Create a Super Admin User

This will be the **first admin** to log in.

### **48.1 Run this command:**

```bash
python manage.py createsuperuser
```

It will ask:
- Username â†’ `admin`
- Email â†’ `admin@example.com`
- Password â†’ `admin123` (choose a strong password)

Confirm password again.

âœ… Superuser created.

---

## ðŸ”¹ Step 49: Create Authentication API

### **49.1 Open file: `resume_analysis/views.py`**

Add these imports at the top:

```python
from django.contrib.auth import authenticate
from rest_framework.authtoken.models import Token
from rest_framework.decorators import authentication_classes, permission_classes
from rest_framework.authentication import TokenAuthentication
from rest_framework.permissions import IsAuthenticated
```

Now, **add this view function at bottom**:

```python
@api_view(['POST'])
def login_view(request):
    username = request.data.get('username')
    password = request.data.get('password')

    user = authenticate(username=username, password=password)

    if user is not None:
        token, created = Token.objects.get_or_create(user=user)
        return Response({'token': token.key})
    else:
        return Response({'error': 'Invalid Credentials'}, status=400)
```

Also, **add logout view**:

```python
@api_view(['POST'])
@authentication_classes([TokenAuthentication])
@permission_classes([IsAuthenticated])
def logout_view(request):
    request.user.auth_token.delete()
    return Response({'message': 'Logged out successfully'})
```

---

## ðŸ”¹ Step 50: Update Backend URLs

### **50.1 Open file: `resume_analysis/urls.py`**

At the top, import:
```python
from .views import login_view, logout_view
```

Then update `urlpatterns`:

```python
urlpatterns = [
    path('upload/', upload_resume, name='upload-resume'),
    path('jobs/', list_jobs, name='list-jobs'),
    path('jobs/<int:pk>/delete/', delete_job, name='delete-job'),
    path('jobs/create/', create_job, name='create-job'),
    path('login/', login_view, name='login'),
    path('logout/', logout_view, name='logout'),
]
```

---

# âœ… Now Backend Authentication API is Ready!

---

## ðŸ”¹ Step 51: Test Login API (Backend)

Use **Postman** or **cURL**.

**POST Request** to:

```
http://127.0.0.1:8000/login/
```

**Body (JSON):**

```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response:**

```json
{
  "token": "d8f8e8a6b25b4b7391764f7c6c26d6bb06f00b2d"
}
```

âœ… You are now logged in!

---

## ðŸ”¹ Step 52: Secure API Endpoints

We only want authenticated users to:
- Create Jobs
- Delete Jobs
- Upload Resumes

Modify those views.

---

### **52.1 In `resume_analysis/views.py`, update:**

For `create_job`, `upload_resume`, `delete_job`, add decorators:

```python
@authentication_classes([TokenAuthentication])
@permission_classes([IsAuthenticated])
```

Example:

```python
@api_view(['POST'])
@authentication_classes([TokenAuthentication])
@permission_classes([IsAuthenticated])
def create_job(request):
    ...
```

Similarly for `upload_resume`, `delete_job`.

âœ… Now only logged-in users with Token can create, upload, or delete.

---

# ðŸ“‚ Full Updated File Summary

| Filepath | Changes |
| :--- | :--- |
| `backend/backend/settings.py` | Added `'rest_framework.authtoken'` |
| `backend/resume_analysis/views.py` | Added `login_view`, `logout_view`, auth decorators |
| `backend/resume_analysis/urls.py` | Added `/login/` and `/logout/` routes |
| `backend` | Ran `migrate`, created superuser |

---

# ðŸš€ Current Status:
- âœ… Backend Authentication Working
- âœ… Tokens Working
- âœ… APIs Protected
- âœ… Superuser Created

---
