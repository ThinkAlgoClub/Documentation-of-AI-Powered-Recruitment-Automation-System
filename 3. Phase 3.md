# **ðŸ“Œ Phase 3: Implement Resume Upload & AI Matching**  

In this phase, we will:  
âœ… **Enable file uploads in Django**  
âœ… **Process resumes (PDF, DOCX) using Python**  
âœ… **Extract text using AI (NLTK, spaCy, or OpenAI)**  
âœ… **Match resumes to job descriptions**  

---

## **ðŸ”¹ Step 11: Create `resume` App for Resume Upload & AI Matching**  
### **11.1 Navigate to Backend Directory**  
```sh
cd recruitment_ai_project  # Navigate to backend directory
source env/bin/activate    # Activate virtual environment
```

### **11.2 Create a New Django App**
```sh
python manage.py startapp resume
```

### **11.3 Register `resume` in `settings.py`**  
Open **`recruitment_ai/settings.py`** and add:  
```python
INSTALLED_APPS = [
    # Other installed apps...
    'resume',  # Resume Upload & AI Matching App
]
```

---

## **ðŸ”¹ Step 12: Configure File Uploads in Django**  

### **12.1 Modify `resume/models.py`**  
```python
import os
from django.db import models
from django.conf import settings

def resume_upload_path(instance, filename):
    return f'resumes/{instance.id}_{filename}'

class Resume(models.Model):
    name = models.CharField(max_length=255)
    email = models.EmailField()
    phone = models.CharField(max_length=20, blank=True, null=True)
    file = models.FileField(upload_to=resume_upload_path)
    uploaded_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.name
```

### **12.2 Create Migration for Database Changes**
```sh
python manage.py makemigrations resume
python manage.py migrate
```

### **12.3 Register Resume Model in Django Admin (`resume/admin.py`)**
```python
from django.contrib import admin
from .models import Resume

admin.site.register(Resume)
```

---

## **ðŸ”¹ Step 13: Implement File Upload API (DRF View & Serializer)**  
### **13.1 Create `resume/serializers.py`**
```python
from rest_framework import serializers
from .models import Resume

class ResumeSerializer(serializers.ModelSerializer):
    class Meta:
        model = Resume
        fields = '__all__'
```

### **13.2 Create `resume/views.py`**
```python
from rest_framework.parsers import MultiPartParser, FormParser
from rest_framework.response import Response
from rest_framework import status, generics
from .models import Resume
from .serializers import ResumeSerializer

class ResumeUploadView(generics.CreateAPIView):
    queryset = Resume.objects.all()
    serializer_class = ResumeSerializer
    parser_classes = (MultiPartParser, FormParser)

    def post(self, request, *args, **kwargs):
        file_serializer = ResumeSerializer(data=request.data)
        if file_serializer.is_valid():
            file_serializer.save()
            return Response(file_serializer.data, status=status.HTTP_201_CREATED)
        else:
            return Response(file_serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

### **13.3 Define URL Routes (`resume/urls.py`)**
```python
from django.urls import path
from .views import ResumeUploadView

urlpatterns = [
    path('upload/', ResumeUploadView.as_view(), name='resume-upload'),
]
```

### **13.4 Include in `recruitment_ai/urls.py`**
```python
from django.urls import path, include

urlpatterns = [
    path('api/resume/', include('resume.urls')),
]
```

---

## **ðŸ”¹ Step 14: Configure Media File Handling**
### **14.1 Modify `settings.py` to Enable File Uploads**
```python
import os

MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
```

### **14.2 Modify `urls.py` to Serve Media Files**
Modify **`recruitment_ai/urls.py`**:
```python
from django.conf import settings
from django.conf.urls.static import static

urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

---

## **ðŸ”¹ Step 15: Install Required AI Dependencies**
```sh
pip install pdfminer.six python-docx spacy
python -m spacy download en_core_web_sm
```
- **pdfminer.six** â†’ Extract text from PDFs  
- **python-docx** â†’ Extract text from Word files  
- **spaCy** â†’ NLP processing  

---

## **ðŸ”¹ Step 16: Implement Resume Parsing (Extract Text)**
### **16.1 Create `resume/utils.py`**
```python
import os
import pdfminer.high_level
import docx
import spacy

nlp = spacy.load("en_core_web_sm")

def extract_text_from_pdf(pdf_path):
    return pdfminer.high_level.extract_text(pdf_path)

def extract_text_from_docx(docx_path):
    doc = docx.Document(docx_path)
    return '\n'.join([para.text for para in doc.paragraphs])

def extract_text(file_path):
    ext = os.path.splitext(file_path)[1].lower()
    if ext == '.pdf':
        return extract_text_from_pdf(file_path)
    elif ext == '.docx':
        return extract_text_from_docx(file_path)
    else:
        return "Unsupported file format"

def analyze_resume(text):
    doc = nlp(text)
    return {"entities": [(ent.text, ent.label_) for ent in doc.ents]}
```

---

## **ðŸ”¹ Step 17: Integrate AI Processing in `views.py`**
Modify `resume/views.py`:
```python
import os
from django.conf import settings
from rest_framework import status, generics
from rest_framework.response import Response
from rest_framework.parsers import MultiPartParser, FormParser
from .models import Resume
from .serializers import ResumeSerializer
from .utils import extract_text, analyze_resume

class ResumeUploadView(generics.CreateAPIView):
    queryset = Resume.objects.all()
    serializer_class = ResumeSerializer
    parser_classes = (MultiPartParser, FormParser)

    def post(self, request, *args, **kwargs):
        file_serializer = ResumeSerializer(data=request.data)
        if file_serializer.is_valid():
            resume = file_serializer.save()
            file_path = os.path.join(settings.MEDIA_ROOT, str(resume.file))
            
            extracted_text = extract_text(file_path)
            analyzed_data = analyze_resume(extracted_text)

            return Response({"resume_data": file_serializer.data, "analysis": analyzed_data}, status=status.HTTP_201_CREATED)
        else:
            return Response(file_serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

---

## **ðŸ”¹ Step 18: Test API**
### **18.1 Start Django Server**
```sh
python manage.py runserver
```

### **18.2 Upload a Resume via cURL**
```sh
curl -X POST http://127.0.0.1:8000/api/resume/upload/ \
    -F "name=John Doe" \
    -F "email=john@example.com" \
    -F "phone=1234567890" \
    -F "file=@/path/to/resume.pdf"
```
